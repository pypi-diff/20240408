# Comparing `tmp/odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0-py3-none-any.whl.zip` & `tmp/odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,22 +1,22 @@
-Zip file size: 60759 bytes, number of entries: 20
--rw-r--r--  2.0 unx     1248 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/README.rst
--rw-r--r--  2.0 unx      194 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/__init__.py
--rw-r--r--  2.0 unx      776 b- defN 23-Dec-30 14:53 odoo/addons/ssi_transaction_win_lost_mixin/__manifest__.py
--rw-r--r--  2.0 unx      824 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/demo/base_lost_reason_demo.xml
--rw-r--r--  2.0 unx      237 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/models/__init__.py
--rw-r--r--  2.0 unx      671 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/models/base_lost_reason.py
--rw-r--r--  2.0 unx     1017 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/models/ir_model.py
--rw-r--r--  2.0 unx     8906 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/models/mixin_transaction_win_lost.py
--rw-r--r--  2.0 unx      357 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/security/ir.model.access.csv
--rw-r--r--  2.0 unx    48333 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/static/description/icon.png
--rw-r--r--  2.0 unx     1210 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/templates/mixin_transaction_win_lost_templates.xml
--rw-r--r--  2.0 unx     2278 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/views/base_lost_reason_views.xml
--rw-r--r--  2.0 unx      679 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/views/ir_model_views.xml
--rw-r--r--  2.0 unx      198 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/wizards/__init__.py
--rw-r--r--  2.0 unx     1670 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason.py
--rw-r--r--  2.0 unx     1478 b- defN 23-Dec-30 14:51 odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason_views.xml
--rw-r--r--  2.0 unx     1821 b- defN 23-Dec-30 14:57 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Dec-30 14:57 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Dec-30 14:57 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2473 b- defN 23-Dec-30 14:57 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/RECORD
-20 files, 74467 bytes uncompressed, 56419 bytes compressed:  24.2%
+Zip file size: 61328 bytes, number of entries: 20
+-rw-r--r--  2.0 unx     1248 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/README.rst
+-rw-r--r--  2.0 unx      194 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/__init__.py
+-rw-r--r--  2.0 unx      776 b- defN 24-Apr-08 04:44 odoo/addons/ssi_transaction_win_lost_mixin/__manifest__.py
+-rw-r--r--  2.0 unx      824 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/demo/base_lost_reason_demo.xml
+-rw-r--r--  2.0 unx      237 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/models/__init__.py
+-rw-r--r--  2.0 unx      671 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/models/base_lost_reason.py
+-rw-r--r--  2.0 unx     1017 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/models/ir_model.py
+-rw-r--r--  2.0 unx    13826 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/models/mixin_transaction_win_lost.py
+-rw-r--r--  2.0 unx      357 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/security/ir.model.access.csv
+-rw-r--r--  2.0 unx    48333 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/static/description/icon.png
+-rw-r--r--  2.0 unx     1614 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/templates/mixin_transaction_win_lost_templates.xml
+-rw-r--r--  2.0 unx     2278 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/views/base_lost_reason_views.xml
+-rw-r--r--  2.0 unx      679 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/views/ir_model_views.xml
+-rw-r--r--  2.0 unx      198 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/wizards/__init__.py
+-rw-r--r--  2.0 unx     1670 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason.py
+-rw-r--r--  2.0 unx     1478 b- defN 24-Apr-08 04:43 odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason_views.xml
+-rw-r--r--  2.0 unx     1819 b- defN 24-Apr-08 04:45 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-08 04:45 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 24-Apr-08 04:45 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2474 b- defN 24-Apr-08 04:45 odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/RECORD
+20 files, 79790 bytes uncompressed, 56988 bytes compressed:  28.6%
```

## zipnote {}

```diff
@@ -42,20 +42,20 @@
 
 Filename: odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason.py
 Comment: 
 
 Filename: odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason_views.xml
 Comment: 
 
-Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/METADATA
+Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/WHEEL
+Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/top_level.txt
+Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/RECORD
+Filename: odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/ssi_transaction_win_lost_mixin/__manifest__.py

```diff
@@ -1,13 +1,13 @@
 # Copyright 2022 OpenSynergy Indonesia
 # Copyright 2022 PT. Simetri Sinergi Indonesia
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/lgpl).
 {
     "name": "Transaction Mixin - Win & Lost State",
-    "version": "14.0.1.4.0",
+    "version": "14.0.1.5.0",
     "website": "https://simetri-sinergi.id",
     "author": "OpenSynergy Indonesia, PT. Simetri Sinergi Indonesia",
     "license": "AGPL-3",
     "installable": True,
     "depends": [
         "ssi_transaction_mixin",
     ],
```

## odoo/addons/ssi_transaction_win_lost_mixin/models/mixin_transaction_win_lost.py

```diff
@@ -1,14 +1,19 @@
 # Copyright 2022 OpenSynergy Indonesia
 # Copyright 2022 PT. Simetri Sinergi Indonesia
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/lgpl).
 
+from inspect import getmembers
+
 from lxml import etree
 
-from odoo import api, fields, models
+from odoo import _, api, fields, models
+from odoo.exceptions import UserError
+
+from odoo.addons.ssi_decorator import ssi_decorator
 
 
 class MixinTransactionWinLost(models.AbstractModel):
     _name = "mixin.transaction_win_lost"
     _inherit = [
         "mixin.transaction",
     ]
@@ -86,23 +91,147 @@
             "state": "lost",
             "lost_reason_id": lost_reason and lost_reason.id or False,
             "real_lost_date": lost_date,
         }
 
     def action_win(self, real_win_date=False):
         for record in self.sudo():
+            record._check_win_policy()
+            record._run_pre_win_check()
+            record._run_pre_win_action()
             record.write(record._prepare_win_data(real_win_date=real_win_date))
+            record._run_post_win_check()
+            record._run_post_win_action()
 
     def action_lost(self, real_lost_date=False, lost_reason=False):
         for record in self.sudo():
+            record._check_lost_policy()
+            record._run_pre_lost_check()
+            record._run_pre_lost_action()
             record.write(
                 record._prepare_lost_data(
                     real_lost_date=real_lost_date, lost_reason=lost_reason
                 )
             )
+            record._run_post_lost_check()
+            record._run_post_lost_action()
+
+    def _run_pre_win_check(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_pre_win_check"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _run_post_win_check(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_post_win_check"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _run_pre_win_action(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_pre_win_action"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _run_post_win_action(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_post_win_action"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _check_win_policy(self):
+        self.ensure_one()
+        if self.env.context.get("bypass_win_policy", False):
+            return True
+
+        if not self.win_ok:
+            error_message = """
+            Context: Mark as win %s
+            Database ID: %s
+            Problem: Document is not allowed to mark as win
+            Solution: Check mark as win policy prerequisite
+            """ % (
+                self._description.lower(),
+                self.id,
+            )
+            raise UserError(_(error_message))
+
+    def _run_pre_lost_check(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_pre_lost_check"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _run_post_lost_check(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_post_lost_check"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _run_pre_lost_action(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_pre_lost_action"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _run_post_lost_action(self):
+        self.ensure_one()
+        cls = type(self)
+        methods = []
+        for _attr, func in getmembers(cls):
+            if self.is_decorator(func, "_post_lost_action"):
+                methods.append(func)
+        if methods:
+            self.run_decorator_method(methods)
+
+    def _check_lost_policy(self):
+        self.ensure_one()
+        if self.env.context.get("bypass_lost_policy", False):
+            return True
+
+        if not self.lost_ok:
+            error_message = """
+            Context: Mark as lost %s
+            Database ID: %s
+            Problem: Document is not allowed to mark as lost
+            Solution: Check mark as lost policy prerequisite
+            """ % (
+                self._description.lower(),
+                self.id,
+            )
+            raise UserError(_(error_message))
 
     def _prepare_restart_data(self):
         self.ensure_one()
         _super = super(MixinTransactionWinLost, self)
         result = _super._prepare_restart_data()
         result.update(
             {
@@ -247,7 +376,29 @@
             view_arch = self._add_view_element(
                 view_arch,
                 "ssi_transaction_win_lost_mixin.lost_reason",
                 "/form/sheet/div[@class='oe_left']/div[@class='oe_title']/h1",
                 "after",
             )
         return view_arch
+
+    @ssi_decorator.insert_on_tree_view()
+    def _01_view_add_tree_lost_button(self, view_arch):
+        if self._automatically_insert_lost_button:
+            view_arch = self._add_view_element(
+                view_arch,
+                "ssi_transaction_win_lost_mixin.tree_button_lost",
+                "/tree/header",
+                "inside",
+            )
+        return view_arch
+
+    @ssi_decorator.insert_on_tree_view()
+    def _01_view_add_tree_win_button(self, view_arch):
+        if self._automatically_insert_win_button:
+            view_arch = self._add_view_element(
+                view_arch,
+                "ssi_transaction_win_lost_mixin.tree_button_win",
+                "/tree/header",
+                "inside",
+            )
+        return view_arch
```

## odoo/addons/ssi_transaction_win_lost_mixin/templates/mixin_transaction_win_lost_templates.xml

### odoo/addons/ssi_transaction_win_lost_mixin/templates/mixin_transaction_win_lost_templates.xml

```diff
@@ -8,14 +8,20 @@
   </template>
   <template id="button_win">
     <button name="action_win" string="Win" type="object" class="oe_highlight" attrs="{'invisible':[('win_ok','!=',True)]}" confirm="Mark as Win. Are you sure?"/>
   </template>
   <template id="button_lost">
     <button name="%(ssi_transaction_win_lost_mixin.base_select_lost_reason_action)d" string="Lost" type="action" attrs="{'invisible':[('lost_ok','!=',True)]}"/>
   </template>
+  <template id="tree_button_win">
+    <button name="action_win" string="Win" type="object" confirm="Mark as Win. Are you sure?"/>
+  </template>
+  <template id="tree_button_lost">
+    <button name="%(ssi_transaction_win_lost_mixin.base_select_lost_reason_action)d" string="Lost" type="action"/>
+  </template>
   <template id="lost_reason">
     <h2 attrs="{'invisible': [('state', '!=', 'lost')]}">
       <label for="lost_reason_id" string="Lost reason:"/>
       <field name="lost_reason_id" class="oe_inline"/>
     </h2>
   </template>
   <template id="win_filter">
```

## Comparing `odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/METADATA` & `odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-ssi-transaction-win-lost-mixin
-Version: 14.0.1.4.0
+Version: 14.0.1.5.0
 Summary: Transaction Mixin - Win & Lost State
 Home-page: https://simetri-sinergi.id
 Author: OpenSynergy Indonesia, PT. Simetri Sinergi Indonesia
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
 Classifier: Framework :: Odoo :: 14.0
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3
 Requires-Python: >=3.6
 Requires-Dist: odoo14-addon-ssi-transaction-mixin
-Requires-Dist: odoo (<14.1dev,>=14.0a)
+Requires-Dist: odoo <14.1dev,>=14.0a
 
 .. image:: https://img.shields.io/badge/licence-AGPL--3-blue.svg
    :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
    :alt: License: AGPL-3
 
 ====================================
 Transaction Mixin - Win & Lost State
```

## Comparing `odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/RECORD` & `odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/RECORD`

 * *Files 11% similar despite different names*

```diff
@@ -1,20 +1,20 @@
 odoo/addons/ssi_transaction_win_lost_mixin/README.rst,sha256=pbe_AACsDEXHvGRYpQ5X37sRH7mUqNpoQRUBOnL62kI,1248
 odoo/addons/ssi_transaction_win_lost_mixin/__init__.py,sha256=wJoQUI3YmB8vss-Ui-9TK6LnDvTJE7JINkW-jl7BEJs,194
-odoo/addons/ssi_transaction_win_lost_mixin/__manifest__.py,sha256=H9vVxAKORmWdcPloPZUgBVawPC6Xi_Us99ePt4mFO_4,776
+odoo/addons/ssi_transaction_win_lost_mixin/__manifest__.py,sha256=zmoNtUe7Bl9MirDMFLmkZ6jRCXlFqZZ1wzGZA_1H0-c,776
 odoo/addons/ssi_transaction_win_lost_mixin/demo/base_lost_reason_demo.xml,sha256=dBO_Ae9_O34lEynXGpwkQSQ61x_2qnfYLgWFlO0tBL4,824
 odoo/addons/ssi_transaction_win_lost_mixin/models/__init__.py,sha256=0Xkg05sEMWnMlHdYrhNjNhL7tdFB6hDes_s8taCobGc,237
 odoo/addons/ssi_transaction_win_lost_mixin/models/base_lost_reason.py,sha256=vDaAtXtMhLHmZ3ZzAn7L6HxBAStaOH5ZqpO-2GrWfVE,671
 odoo/addons/ssi_transaction_win_lost_mixin/models/ir_model.py,sha256=rYDrWTZpwBaBUtOojyHGaGt7L3RjZsaTv8QIvUzwZeU,1017
-odoo/addons/ssi_transaction_win_lost_mixin/models/mixin_transaction_win_lost.py,sha256=3vDY6nHipTJ22JwyzVUKh8YkE6rgAqZqz4loIiZOkgo,8906
+odoo/addons/ssi_transaction_win_lost_mixin/models/mixin_transaction_win_lost.py,sha256=Y9azSqNHcdzPD2XHkycWXxD0b-QGiXlaw41qsxWsBAM,13826
 odoo/addons/ssi_transaction_win_lost_mixin/security/ir.model.access.csv,sha256=nTxxmx9UVXqtt8TQTPBGZvlOWDyLFNRcVn7PTxxEIcc,357
 odoo/addons/ssi_transaction_win_lost_mixin/static/description/icon.png,sha256=lNGJOSg4cMRfwPTfFKVT6d5B2N1N83iVpEEN1blqu1I,48333
-odoo/addons/ssi_transaction_win_lost_mixin/templates/mixin_transaction_win_lost_templates.xml,sha256=KDXdMJjLaO-JsoBlYeMMGrQzAvZcoe4dSMgmK5zJxcg,1210
+odoo/addons/ssi_transaction_win_lost_mixin/templates/mixin_transaction_win_lost_templates.xml,sha256=Eid5p-7Ql5BSIfe69OpLVyvE-rAKUAPJqkjreejkfd4,1614
 odoo/addons/ssi_transaction_win_lost_mixin/views/base_lost_reason_views.xml,sha256=8sXuXh2YHbfuJ2AL6Uw4J-sBDxMOjLMbbuA8QPdMF3E,2278
 odoo/addons/ssi_transaction_win_lost_mixin/views/ir_model_views.xml,sha256=wCYb6w4t2TyUrXXeVWxYYoYLeRPIBsegw3HqtfCtvsY,679
 odoo/addons/ssi_transaction_win_lost_mixin/wizards/__init__.py,sha256=vzlWyCIRC0tv6Y3hHRzx95jIml8Z1jrFpoIx94jqXWU,198
 odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason.py,sha256=-SoEOiMn0anK4bazh_XGrLSczuSLkekvCSQdCh30298,1670
 odoo/addons/ssi_transaction_win_lost_mixin/wizards/base_select_lost_reason_views.xml,sha256=LUNkuSMtdyz6pdTrCX_MmGizHwhKmxvO58kZzrrsY-Y,1478
-odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/METADATA,sha256=9CYkrO09NEbPSjczNO3HuvUT4qmiqOQhR1wnj6HXMfY,1821
-odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.4.0.dist-info/RECORD,,
+odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/METADATA,sha256=sryg9HFZXI3SGsTj1rWexsxFYFTKGFtFDr0XR2SUbzY,1819
+odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
+odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_ssi_transaction_win_lost_mixin-14.0.1.5.0.dist-info/RECORD,,
```

